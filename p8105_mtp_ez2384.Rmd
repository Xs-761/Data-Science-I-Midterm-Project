---
title: "Data Science I, Midterm Project"
output: github_document
---

```{r Packages, message=FALSE}
# Load Necessary Packages
  library(ggplot2)
  library(tidyverse)
  library(dplyr)
  library(tidyr)

# Preliminary Loading of All Datasets
  NYC_Rental_Price = read.csv("./NYC Rental.csv")
  NYC_Zipcode      = read.csv("./NYC Zipcode.csv")
  US_Housing_Price = read.csv("./US Housing 2023.csv")

```

### Problem 1: Data Import and Cleaning

##### [Discussion] Description and Processing of Raw Datasets   
- `NYC_Rental_Price Dataset`    
  - Description: contain detailed NYC Rental Prices between Jan.2015 to Aug.2024 listed by zip codes   
  - Dimension: `r nrow(NYC_Rental_Price)` x `r ncol(NYC_Rental_Price)`    
  - Unique Zipcodes: `r n_distinct(NYC_Rental_Price$RegionName)`
  - Issues:   
    - ambiguous column names        
      - Column name `RegionName` actually consists entirely of zipcode information, which is very misleading.   
      - Column names of form `X2015.1.31` should be renamed for better readability.    
    - redundant columns   
      - Column `RegionID` is useless as we can treat the zipcode variable as the unique identifier.
      - The entire dataset is within NYC so columns `StateName`, `State`, `City`, `Metro` can be removed.
      - Column `SizeRank` is never used for future analysis.
      - Column `RegionType` has only `r n_distinct(NYC_Rental_Price$RegionType)` level of value and is useless.
    - too much missing data    
  - Data Cleaning Strategy:
    - Rename and Keep only the following columns: `county`, `zipcode`, and all date columns of form `%yyyy%mm%dd`.
    - Remove records containing empty values.
- `NYC_Zipcode Dataset`   
  - Description: contain detailed zipcode-location associations within NYC    
  - Dimension: `r nrow(NYC_Zipcode)` x `r ncol(NYC_Zipcode)`    
  - Unique Zipcodes: `r n_distinct(NYC_Zipcode$ZipCode)`
  - Issues:
    - redundant columns
      - Only column `County`, `ZipCode`, `Neighborhood` is useful.
  - Data Cleaning Strategy:
    - Rename and Keep only columns `county` and `zipcode`.
    - Also per instruction required, add `borough` variable.
- `US_Housing_Price Dataset`    
  - Description: contains detailed housing prices information within entire U.S. associated with specific area    
  - Dimension: `r nrow(US_Housing_Price)` x `r ncol(US_Housing_Price)`   
  - Issues:   
    - ambiguous columns   
      - Column name `RegionName` actually consists entirely of zipcode information, which is very misleading. 
      - Column names of form `X2015.1.31` should be renamed for better readability.  
    - redundant columns   
      - Only zipcodes, State, and date columns are used in future analysis.   
    - missing data
  - Data Cleaning Strategy:   
    - Rename and Keep only variables `zipcode`, `state`, and all date columns of form `%yyyy%mm%dd`.
    - Remove records containing empty values.

##### [Code Chunk] Raw Data Cleaning    
```{r Raw Data Cleaning}

  NYC_Rental_Price = NYC_Rental_Price %>% janitor::clean_names() %>% select(-region_id, -size_rank, -region_type, -state_name, -state, -city, -metro) %>%
                     rename("zipcode"="region_name", "county"="county_name") %>% mutate(county=gsub(" County","",county)) %>% mutate(across(where(is.numeric), \(x) round(x, 2))) %>%
                     drop_na() %>% arrange(zipcode)
                     colnames(NYC_Rental_Price)[3:ncol(NYC_Rental_Price)] <- colnames(NYC_Rental_Price)[3:ncol(NYC_Rental_Price)] %>% sub("x", "", .) %>% gsub("_", "/", .) %>%
                                                                             sub("(\\d{4})/(\\d{1})/(\\d{2})", "\\1/0\\2/\\3", .)
                     
  NYC_Zipcode = NYC_Zipcode %>% janitor::clean_names() %>% select(county, zip_code, neighborhood) %>% rename("zipcode"="zip_code") %>% drop_na() %>% 
                mutate(borough=recode(county, "Kings"="Brooklyn", "New York"="Manhattan", "Richmond"="Staten Island")) %>% relocate(zipcode, county, borough)
  
  US_Housing_Price = US_Housing_Price %>% janitor::clean_names() %>% select(region_name, state, starts_with("x")) %>% rename("zipcode"="region_name") %>% drop_na() %>% arrange(zipcode)
                     colnames(US_Housing_Price)[3:ncol(US_Housing_Price)] <- colnames(US_Housing_Price)[3:ncol(US_Housing_Price)] %>% sub("x", "", .) %>% gsub("_", "/", .) %>%
                                                                             sub("(\\d{4})/(\\d{1})/(\\d{2})", "\\1/0\\2/\\3", .)
                     
```

##### [Code Chunk] Merge NYC_Rental and NYC_Zipcode Datasets       
```{r Merge Datasets}

  Merged = left_join(x=NYC_Zipcode, y=NYC_Rental_Price, by="zipcode") %>% rename("county"="county.x") %>% select(-county.y) %>% relocate(zipcode, county, borough, neighborhood) %>% drop_na()

```
##### [Discussion] Merged Datasets, Issues, Fixing
- The merged dataset has several issues, firstly there are many missing values under the county column from the `NYC_Rental_Price` dataset, so we drop `county.y` as all information is
  available in `county.y`. The merged dataset has no missing values for the character variables `zipcode`, `borough`, `county` but has plenty of missing values for the numeric ones.
  Remove records containing empty values.

##### Discussion on TIDYed Dataset       

- `NYC_Rental_Price` Dataset
  - Dimension: `r nrow(NYC_Rental_Price)` x `r ncol(NYC_Rental_Price)`
  - Unique Zipcodes: `r n_distinct(NYC_Rental_Price$zipcode)`

- `NYC_Zipcode` Dataset
  - Dimension: `r nrow(NYC_Zipcode)` x `r ncol(NYC_Zipcode)`
  - Unique Zipcodes: `r n_distinct(NYC_Zipcode$zipcode)`

- `US_Housing_Price` Dataset
  - Dimension `r nrow(US_Housing_Price)` x `r ncol(US_Housing_Price)`

- The merged `Merged` Dataset
  - Dimension `r nrow(Merged)` x `r ncol(Merged)`
  - Unique Zipcodes: `r n_distinct(Merged$zipcode)`
  - Unique Neighborhoods: `r n_distinct(Merged$neighborhood)`

The distinction between datasets `NYC_Rental_Price` and `NYC_Zipcode` in terms of the number of Zipcodes is probably due to    
1. There are non-unique zipcode present in the `NYC_Zipcode` dataset    
1. Many records of the `NYC_Rental_Price` were removed due to incomplete data   
1. The `NYC_Zipcode` dataset is not covering every corner within NYC so it is not as thorough as the zipcodes in the `NYC_Zipcode` dataset    

After identifying non-unique zipcodes, rectify the cleaned datasets to ensure `zipcode` is unique-identifer among all datasets.
```{r Ensure zipcode as unique-identifier}
  
  NYC_Rental_Price %>% group_by(zipcode) %>% filter(n() > 1) %>% distinct(zipcode)  # zipcodes all unique
  NYC_Zipcode %>% group_by(zipcode) %>% filter(n() > 1) %>% distinct(zipcode)       # zipcode 10463 and 11201
  US_Housing_Price %>% group_by(zipcode) %>% filter(n() > 1) %>% distinct(zipcode)  # zipcodes all unique
  Merged %>% group_by(zipcode) %>% filter(n() > 1) %>% distinct(zipcode)            # zipcode 11201

  NYC_Zipcode %>% filter(zipcode==11201 | zipcode==10463)       # correct data should be: 11201--Kings--Brooklyn & 10463--Bronx--Bronx
  Merged %>% filter(zipcode==11201)                             # correct data should be: 11201--Kings--Brooklyn
  
  NYC_Zipcode = NYC_Zipcode %>% filter(!(zipcode==11201 & county=="New York")) %>% filter(!(zipcode==10463 & county=="New York"))
  Merged = Merged %>% filter(!(zipcode==11201 & county=="New York"))
  
```


```{r}

```

##### Report Objectives   














