Data Science I, Midterm Project
================

``` r
# Load Necessary Packages
  library(ggplot2)
  library(tidyverse)
  library(dplyr)
  library(tidyr)

# Preliminary Loading of All Datasets
  NYC_Rental     = read.csv("./NYC Rental.csv")
  NYC_Zipcode    = read.csv("./NYC Zipcode.csv")
  US_Housing_2023= read.csv("./US Housing 2023.csv")
```

### Problem 1: Data Import and Cleaning

##### Provide a brief introduction to the raw data and the goals of your report

- **NYC_Rental Datasest**
  - Description: Zillow Observed Rent Index (ZORI) in New York City
    between January 2015 and August 2024
  - Dimension: 149 x 125
  - Issues require addressing:
    - In the raw dataset, *RegionName* actually correspond to zipcode
      within NYC, very misleading.
    - Columns 2015/1/31 ~ 2024/8/31 contains lots of missing values.
    - Column `RegionType`, `StateName`, `State`, `City` consists
      respectively values “zip”, “NY”, “NY”, “New York” throughout and
      thus useless due to the nature of this dataset.
  - Goals:
    - Address the abovementioned issues.
    - Clean and Tidy
    - Merge the NYC_Zipcode Dataset with NYC_Rental Dataset.
- **NYC_Zipcode Dataset**
  - Description: Data on Zipcodes in NYC
  - Dimension: 322 x 7
  - Issues require addressing:
    - /
  - Goals:
    - Clean and Tidy
    - Create a new column `borough` based on county names
    - Merge with NYC_Rental Dataset
- **US_House_Price Dataset**
  - Description: Zillow Home Value Index (ZHVI) in regions across the
    United States in 2023
  - Dimension: 26338 x 21
  - Issues require addressing:
  - Goals:

##### Import, Tidy, and otherwise Clean the NYC Rental Data & ZIP Code Data

In the Zipcode Data, create a borough variable using county names.

``` r
  NYC_Rental = NYC_Rental %>% janitor::clean_names() %>% drop_na() %>% rename(., "zip_code"="region_name", "county"="county_name") %>% 
               select(-region_type, -state_name, -state, -city) %>% relocate(zip_code) %>% arrange(zip_code)
               colnames(NYC_Rental)[6:ncol(NYC_Rental)] <- colnames(NYC_Rental)[6:ncol(NYC_Rental)] %>% sub("x", "", .) %>% gsub("_", "/", .)
               
  NYC_Zipcode= NYC_Zipcode %>% janitor::clean_names() %>% 
               mutate(borough=recode(county, "Bronx"="The Bronx", "Kings"="Brooklyn", "Queens"="Queens", "New York"="Manhattan", "Richmond"="Staten Island"), county=paste0(county, " County")) %>%
               relocate(zip_code, county, borough) %>% arrange(zip_code)
```

Merge the NYC Rental Dataset and Zipcode Dataset(by Zipcode); identify
and resolve any issues that arise.

``` r
  Merged = left_join(x=NYC_Zipcode, y=NYC_Rental, by="zip_code") %>% rename("county_zipcode"="county.x", "county_rental"="county.y") %>% relocate(zip_code, county_zipcode, county_rental) %>%
           mutate_if(is.character, ~ replace_na(., "missing")) %>% mutate_if(is.numeric, ~ replace_na(., 0))
```

- After merging, we have 2 potential problems:
  - Merged Dataset has conflicting column `county` as they appear in
    both constituting datasets.
  - After merging, lots of missing values appeared as many observations
    from NYC_Rental dataset do not have matching records with the
    corresponding zip_code from NYC_Zipcode dataset.
- Problem Solving
  - To distinguish county variables, I added post-fix afterwards to
    indicate the source dataset.
  - Replaced `NA` with “missing” for character variables and 0 for
    numeric variables so that the dataset does not have empty values.

Description of resulting TIDY dataset (this is not the final Merged
dataset):  
- Total Observations: 322  
- Unique Zipcodes: 320  
- Unique Neighborhoods: 42

Data Quality Checking Steps, Issues Detected, and Fixing Procedures:  
- There are 322 total records but only 320 unique zipcodes, implying 2
repetitive records. Upon further investigating, these records correspond
to the zipcode of 10463 and 11201, which IN FACT associates with Bronx
and Kings, respectively. Therefore, I have UPDATED the Merged dataset to
reflect this change, and keep only the county_zipcode as the true county
information, renamed it to “county”  
- There are now two columns indicating the same county information, drop
the redundant county_rental column.

``` r
# Check for repetitive lines #
  Merged %>% select(c(1:3)) %>% group_by(zip_code) %>% filter(n() > 1) %>% ungroup()
```

    ## # A tibble: 4 × 3
    ##   zip_code county_zipcode  county_rental
    ##      <int> <chr>           <chr>        
    ## 1    10463 Bronx County    missing      
    ## 2    10463 New York County missing      
    ## 3    11201 Kings County    Kings County 
    ## 4    11201 New York County Kings County

``` r
# Update Merged dataset to fix the error #
  Merged = Merged %>% mutate(county_zipcode = case_when(
    zip_code == 10463 ~ "Bronx County",
    zip_code == 11201 ~ "Kings County",
    TRUE ~ county_zipcode  # Keeps original values for non-matching rows
  )) %>%
    distinct(zip_code, .keep_all = TRUE) %>% select(-county_rental) %>% rename("county"="county_zipcode")
```

##### Import, Tidy, and otherwise Clean the US_Housing_2023 Data

``` r
  US_Housing_2023 = US_Housing_2023 %>% janitor::clean_names() %>% drop_na() %>% rename("zip_code"="region_name") %>% arrange(zip_code) %>% relocate(zip_code)
                    colnames(US_Housing_2023)[10:ncol(US_Housing_2023)] <- colnames(US_Housing_2023)[10:ncol(US_Housing_2023)] %>% sub("x", "", .) %>% gsub("_", "/", .)
```

Major Steps in Data Wrangling Process  
- Restricted dataset to only variables necessary for later parts of the
report (补齐)

``` r
  US_Housing_2023 = US_Housing_2023 %>% select(-region_type)
```

- Using `sub()` and `gsub()` functions to make US_Housing_2023 dataset
  has column names of form “%yyyy%mm%dd” to stay consistent with that of
  the original  
- Renamed misleading variable name “region_name” to “zip_code”; sorted
  dataset according to ascending zip_code, and relocate it to the very
  front

### Problem 2: Quality Control and EDA

- There are 116 months between Jan.2015 and Aug.2024, but in the NYC
  Rental Dataset many ZIP codes have fewer than 116 observations.
  Discuss why this might be the case.
  - The discrepancy might be due to the fact that
- Compare the number of ZIP codes in the NYC Rental Dataset to the
  number of ZIP codes in the Zipcode dataset:
  - The total number of Zipcodes in the NYC Rental Dataset is 48 whereas
    the total number of Zipcodes in the Zipcode dataset is 320
  - What reasons might explain any discrepancy?
    - The discrepancy might be due to the fact that not all areas within
      the NYC have been researched thoroughly and the data are missing.
    - Also, many of the original dataset contains empty values that was
      filtered out during data-cleaning procedures.
- Create a reader-friendly table showing the average rental price in
  each borough and year(not month).

``` r
  Merged_longer = Merged |> pivot_longer(cols=starts_with("2"), names_to="date", values_to="rental_price") |> mutate(year=substr(date,1,4))

  temp_table = Merged_longer |> group_by(borough, year) |> summarise(mean_price = mean(rental_price[rental_price != 0]))
```

    ## `summarise()` has grouped output by 'borough'. You can override using the
    ## `.groups` argument.

``` r
  Table_MeanPrice = temp_table |> pivot_wider(names_from=borough, values_from=mean_price) |> janitor::clean_names()
  Table_MeanPrice
```

    ## # A tibble: 10 × 6
    ##    year  brooklyn manhattan queens staten_island the_bronx
    ##    <chr>    <dbl>     <dbl>  <dbl>         <dbl>     <dbl>
    ##  1 2015     2539.     3046.  2284.           NaN       NaN
    ##  2 2016     2617.     3088.  2369.           NaN       NaN
    ##  3 2017     2659.     3111.  2399.           NaN       NaN
    ##  4 2018     2704.     3157.  2415.           NaN       NaN
    ##  5 2019     2814.     3245.  2536.           NaN       NaN
    ##  6 2020     2787.     3078.  2519.           NaN       NaN
    ##  7 2021     2817.     3089.  2546.           NaN       NaN
    ##  8 2022     3309.     3698.  2857.           NaN       NaN
    ##  9 2023     3496.     3842.  3052.           NaN       NaN
    ## 10 2024     3610.     3953.  3178.           NaN       NaN

- The rental prices of all boroughs in New York City reveal a clear
  INCREASING TREND over years 2015 to 2024.
- Whereas Manhattan has MOST EXPENSIVE mean rental prices each year from
  2015 to 2024 among all five boroughs of New York City, () has the
  LEAST EXPENSIVE ones.

### Problem 3: Visualization
